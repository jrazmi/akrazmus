{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./db/knex.js","webpack:///./knexfile.js","webpack:///./src/context.js","webpack:///./src/index.js","webpack:///./src/loaders/index.js","webpack:///./src/middleware/auth/index.js","webpack:///./src/middleware/auth/rules/hasGlobalPerm.js","webpack:///./src/middleware/auth/rules/index.js","webpack:///./src/middleware/auth/rules/isAuthenticated.js","webpack:///./src/models/account/index.js","webpack:///./src/models/account/me.js","webpack:///./src/models/account/register.js","webpack:///./src/models/account/requestLogin.js","webpack:///./src/models/account/requestPasswordReset.js","webpack:///./src/models/account/resetPassword.js","webpack:///./src/resolvers/index.js","webpack:///./src/types/index.js","webpack:///./src/util/FormatEmail.js","webpack:///./src/util/aws/index.js","webpack:///./src/util/index.js","webpack:///./src/util/templates/EmailRPR.js","webpack:///external \"aws-sdk\"","webpack:///external \"bcryptjs\"","webpack:///external \"dataloader\"","webpack:///external \"dotenv\"","webpack:///external \"express-jwt\"","webpack:///external \"graphql-shield\"","webpack:///external \"graphql-yoga\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"knex\"","webpack:///external \"lodash\"","webpack:///external \"merge-graphql-schemas\"","webpack:///external \"path\""],"names":["environment","process","config","require","module","exports","test","client","connection","env","TEST_DATABASE_URL","migrations","tableName","directory","seeds","development","DATABASE_URL","production","PRODUCTION_DATABASE_URL","req","res","db","currentUser","loaders","user","id","SingleLoader","email","permissions","global","userId","ManyLoader","load","server","GraphQLServer","typeDefs","resolvers","context","request","response","middlewares","AuthMiddleware","express","use","jwt","secret","TOKEN_SECRET","credentialsRequired","getToken","fromHeaderOrQuerystring","headers","authorization","split","query","token","options","endpoint","subscriptions","playground","cors","credentials","origin","FRONTEND_HOST","formatError","err","message","start","port","console","log","table","key","DataLoader","keys","whereIn","select","then","rows","map","ikey","find","x","filter","shield","Query","AccountQuery","Mutation","AccountMutation","fallbackError","debug","allowExternalErrors","hasGlobalPerm","perm","rule","cache","root","args","ctx","info","deleted","perms","_","includes","isAuthenticated","parent","me","ShieldQuery","requestLogin","register","requestPasswordReset","resetPassword","ShieldMutation","formattedEmail","FormatEmail","input","existing","code","success","nextPage","userData","Object","assign","password","bcrypt","hash","insert","return","credAuthError","valid","compare","jsonwebtoken","sign","expiresIn","resetToken","templateParams","link","emailParams","Destination","ToAddresses","Message","Body","Text","Charset","Data","EmailRPR","Html","Subject","Source","FROM_EMAIL","sendEmail","ses","promise","validJWT","verify","e","updatedPassword","updatedUser","where","update","returning","typesArray","fileLoader","path","__dirname","typesMerged","mergeTypes","trim","toUpperCase","AWS","accessKeyId","AWS_ACCESS_KEY","secretAccessKey","AWS_SECRET_KEY","region","SES","apiVersion","type","content","first_name","first_names"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","const environment = process.env.NODE_ENV\nconst config = require('../knexfile.js')[environment];\nmodule.exports = require('knex')(config);","require(\"dotenv\").config();\n\nmodule.exports = {\n  test: {\n    client: 'pg',\n    connection: process.env.TEST_DATABASE_URL,\n    migrations: {\n      tableName: \"knex_migrations\",\n      directory: `./db/migrations`\n    },\n    seeds: {\n      directory: './db/seeds/test'\n    }\n  },\n  development: {\n    client: \"pg\",\n    connection: process.env.DATABASE_URL,\n    migrations: {\n      tableName: \"knex_migrations\",\n      directory: `./db/migrations`\n    }\n  },\n  production: {\n    client: \"pg\",\n    connection: process.env.PRODUCTION_DATABASE_URL,\n    migrations: {\n      tableName: \"knex_migrations\",\n      directory: `./db/migrations`\n    }\n  }\n};","import { SingleLoader, ManyLoader } from './loaders';\n\nexport default async (req, res, db) => {\n    let currentUser;\n    // initialize dataloaders to context\n    const loaders = {\n        user: {\n            id: SingleLoader('users', 'id'),\n            email: SingleLoader('users', 'email')\n        },\n        permissions: {\n            global: {\n                userId: ManyLoader('global_permissions', 'user_id'),\n            }\n        }\n    }\n\n    // load currentuser into context\n    // do we want to actually load user or no?\n    // console.log(req)\n    if(req && req.user) {\n        currentUser = await loaders.user.id.load(req.user.id);\n    }\n\n    return {\n        req,\n        res,\n        currentUser: currentUser,\n        db,\n        loaders: loaders,\n    }\n};","import { GraphQLServer } from \"graphql-yoga\";\nimport jwt from 'express-jwt';\nimport resolvers from \"./resolvers\";\nimport typeDefs from \"./types\";\nimport context from './context';\nimport { AuthMiddleware } from './middleware/auth';\nconst db = require('../db/knex.js');\n\nrequire(\"dotenv\").config();\n\nconst server = new GraphQLServer({\n    typeDefs,\n    resolvers,\n    context: ({request, response}) => context(request,response, db),\n    middlewares:[\n      AuthMiddleware\n    ]\n});\n\nserver.express.use(jwt({\n    secret: process.env.TOKEN_SECRET,\n    credentialsRequired: false,\n    //allow for auth header or token query param\n    getToken: function fromHeaderOrQuerystring (req) {\n      if (req.headers.authorization && req.headers.authorization.split(' ')[0] === 'Bearer') {\n        return req.headers.authorization.split(' ')[1];\n      } else if (req.query && req.query.token) {\n        return req.query.token;\n      }\n      return null;\n    }\n  }));\n\nconst options = {\n  endpoint: \"/graphql\",\n  subscriptions: \"/subscriptions\",\n  playground: \"/playground\",\n  cors: {\n    credentials: true,\n    origin: process.env.NODE_ENV === 'test' ? '*' : process.env.FRONTEND_HOST\n  },\n  formatError: err => {\n    return {message: err.message}\n  }\n}\n\nserver.start(options, ({port}) => {\n  console.log(`Server started, listening on port ${port} for incoming requests.`);\n});\n","import DataLoader from 'dataloader';\nconst db = require('../../db/knex.js');\n\nexport const SingleLoader = (table, key) => new DataLoader(\n    (keys) => {\n        return(\n            db.table(table)\n            .whereIn(key, keys).select()\n            .then(rows => {\n                return(\n                    keys.map(ikey=>{\n                        return(\n                            rows.find(x=>x[key] === ikey)\n                        )\n                    }\n                    )\n                )\n            })\n        )\n    }\n)\n\nexport const ManyLoader = (table, key) => new DataLoader(\n    (keys) => {\n        return(\n            db.table(table)\n            .whereIn(key, keys).select()\n            .then(rows => {\n                return(\n                    keys.map(ikey=>{\n                        return(\n                            rows.filter(x=>x[key] === ikey)\n                        )\n                    }\n                    )\n                )\n            })\n        )\n    }\n)","import { shield } from 'graphql-shield';\n\nimport { ShieldQuery as AccountQuery, ShieldMutation as AccountMutation } from '../../models/account';\n\n\nexport const AuthMiddleware = shield({\n        Query:{\n            ...AccountQuery\n        },\n        Mutation:{\n            ...AccountMutation\n        }, \n    },\n    {\n        fallbackError: \"Not Authorized\",\n        debug: process.env.NODE_ENV !== \"production\",\n        allowExternalErrors: true\n    }\n);","import { rule } from 'graphql-shield';\nimport _ from \"lodash\";\n\nexport const hasGlobalPerm = (perm) => rule({cache: \"contextual\"})(async(root,args,ctx,info) => {\n    if(!ctx.currentUser) return false;\n    if(ctx.currentUser.deleted) return false;\n    const perms = await ctx.loaders.permissions.global.userId.load(ctx.currentUser.id);\n    // iterate over permissions map permission values to an array\n    // return true/false if permission exists\n    return _.includes(_.map(perms, 'permission'), perm);\n})","export { isAuthenticated } from './isAuthenticated';\nexport { hasGlobalPerm } from './hasGlobalPerm';","import { rule } from 'graphql-shield';\n\nexport const isAuthenticated = rule({cache: \"contextual\"})(async(parent, args, ctx) => {\n    if(!ctx.currentUser) return false;\n    if(ctx.currentUser.deleted) return false;\n    return true\n})","import { me } from './me';\nimport { requestLogin } from './requestLogin';\nimport { register } from './register';\nimport { requestPasswordReset } from './requestPasswordReset';\nimport { resetPassword } from './resetPassword';\nimport { isAuthenticated, hasGlobalPerm } from '../../middleware/auth/rules';\n\nexport const Query = {\n    me\n}\n\nexport const ShieldQuery = {\n    me: isAuthenticated\n}\n\n\nexport const Mutation = {\n    requestLogin,\n    register,\n    requestPasswordReset,\n    resetPassword,\n}\n\nexport const ShieldMutation = {\n}","export const me = async(root,args,ctx,info) => {\n    return ctx.currentUser\n}","import { FormatEmail } from '../../util';\nimport bcrypt from 'bcryptjs';\n\nexport const register = async(root,args,ctx,info) => {\n    // Load user from formatted email\n    const formattedEmail = FormatEmail(args.input.email);\n    const existing = await ctx.loaders.user.email.load(formattedEmail);\n    if(existing){\n        return(\n            {\n                code: \"DUPLICATE\",\n                success: false,\n                message: \"Go Log In!\",\n                nextPage: \"/login\"\n            }\n        )\n    }\n\n    const userData = Object.assign({}, args.input, {\n        password: await bcrypt.hash(args.input.password, 10),\n        email: formattedEmail,\n    });\n\n    const user = await ctx.db('users').insert(userData).return('*');\n    \n    return(\n        {\n            code: \"OK\",\n            success: true,\n            message: \"Go Log In!\",\n            nextPage: \"/login\"\n        }\n    )\n\n}","import jsonwebtoken from 'jsonwebtoken';\nimport bcrypt from 'bcryptjs';\nimport { FormatEmail } from '../../util';\n\nexport const requestLogin = async(root,args,ctx,info) => {\n    // Load user from formatted email\n    const user = await ctx.loaders.user.email.load(FormatEmail(args.email));\n\n    //set Generic Invalid Credential error\n    const credAuthError = { code: \"DOES_NOT_EXIST\", success: false, message: \"Could not find matching user with these credentials\"};\n\n    // if no user exists return GIC\n    if(!user){\n        return credAuthError\n    }\n\n    // compare password and return GIC if mismatch\n    const valid = await bcrypt.compare(args.password, user.password);\n    if(!valid){\n        return credAuthError\n    }\n\n    //if user has been deleted/suspended return susspension error\n    if(user.deleted){\n        return { code: \"REVOKED\", success: false, message: \"Access for this user account has been revoked.\"}\n    }\n\n    // set token for user\n    const token = jsonwebtoken.sign({ id: user.id, email: user.email }, process.env.TOKEN_SECRET, {\n        expiresIn: '30d'\n    })\n    \n    \n\n    return {\n        code: \"OK\",\n        success: true,\n        message: \"Login Successful\",\n        token: token,\n    }\n};\n","import { FormatEmail } from '../../util';\nimport { ses } from '../../util/aws';\nimport { EmailRPR } from '../../util/templates/EmailRPR';\nimport jsonwebtoken from 'jsonwebtoken';\n\nexport const requestPasswordReset = async ( root, args, ctx, info ) => {\n    // Load user from formatted email\n    const formattedEmail = FormatEmail(args.email);\n    const user = await ctx.loaders.user.email.load(formattedEmail);\n\n    //set Generic Invalid Credential error\n    const credAuthError = { code: \"DOES_NOT_EXIST\", success: false, message: \"Could not find matching user with these credentials\"};\n\n    //if not user return GIC\n    if(!user){\n        return credAuthError\n    }\n    const resetToken = jsonwebtoken.sign({ id: user.id, email: user.email }, process.env.TOKEN_SECRET, {\n        expiresIn: '1h'\n    });\n\n    const templateParams = {\n        link: `${args.link}?token=${resetToken}`,\n        user: user\n    }\n\n    // construct email parameters\n    const emailParams = {\n        Destination: {\n            ToAddresses: [user.email]\n          },\n          Message: {\n            Body: {\n              Text: {\n                Charset: \"UTF-8\",\n                Data: EmailRPR(\"text\", templateParams)\n              },\n              Html: {\n                Charset: \"UTF-8\",\n                Data: EmailRPR(\"html\", templateParams)\n              }\n            },\n            Subject: {\n              Charset: \"UTF-8\",\n              Data: \"Request Password Reset\"\n            }\n          },\n          Source: process.env.FROM_EMAIL\n    }\n    \n    //send email if not running tests.\n    if(process.env.NODE_ENV !== 'test'){\n      const sendEmail = await ses.sendEmail(emailParams).promise();\n    };\n\n    return{\n        code: \"OK\",\n        success: true,\n        message: \"Check your email for a reset link\"\n    }\n}","import jsonwebtoken from 'jsonwebtoken';\nimport { FormatEmail } from '../../util';\nimport bcrypt from 'bcryptjs';\n\nexport const resetPassword = async ( root, args, ctx, info ) => {\n    let validJWT;\n    //verify that a valid jwt was passed in\n    try {\n        validJWT = await jsonwebtoken.verify(args.token, process.env.TOKEN_SECRET);\n    } catch(e){\n        return({\n            code: \"EXPIRED\",\n            success: false,\n            message: \"This token is either invalid or expired\"\n        })\n    }\n\n    // get user from jwt args\n    const user = await ctx.loaders.user.email.load(FormatEmail(validJWT.email));\n    \n    //set Generic Invalid Credential error\n    const credAuthError = { code: \"DOES_NOT_EXIST\", success: false, message: \"Could not find matching user with these credentials\"};\n\n    // if no user exists return GIC\n    if(!user){\n        return credAuthError\n    }\n\n    // bcrypt new password\n    const updatedPassword = await bcrypt.hash(args.password, 10);\n\n    //update new password\n    const updatedUser = await ctx.db('users').where('id', user.id).update({password: updatedPassword}).returning('*');\n\n    return{\n        code: \"OK\",\n        success: true,\n        message: \"Password has been updated\"\n    }\n}","import { Query as AccountQuery, Mutation as AccountMutation } from '../models/account';\n\n\nexport default {\n    Query:{\n        ...AccountQuery\n    },\n    Mutation: {\n        ...AccountMutation\n    }\n}\n","import * as path from \"path\";\nimport { fileLoader, mergeTypes } from \"merge-graphql-schemas\";\n\nconst typesArray = fileLoader(path.join(__dirname, \"../**/*.graphql\"));\nconst typesMerged = mergeTypes(typesArray);\n\nexport default typesMerged;","export const FormatEmail = (email) => {\n    return email.trim().toUpperCase()\n}","import AWS from 'aws-sdk';\n\nAWS.config.update({\n    accessKeyId: process.env.AWS_ACCESS_KEY,\n    secretAccessKey: process.env.AWS_SECRET_KEY,\n    region: 'us-east-1'\n})\n\nexport const ses = new AWS.SES({apiVersion: '2010-12-01'});\n","export { FormatEmail } from './FormatEmail';","export const EmailRPR = (type, content) => {\n\tif (type ==='text'){\n\t\treturn(\n\t\t\t`\n\t\t\t${content.user.first_name || \"friend\"}\n\t\t\tReset your password: ${content.link}\n\t\t\t`\n\t\t)\n\t}\n\n\treturn(\n\t\t`<html xmlns=\"http://www.w3.org/1999/xhtml\">\n\t\t<head>\n\t\t\t<title>Reset Password Request</title>\n\t\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><meta name=\"viewport\" content=\"width=device-width\">\n\t\t\t<style type=\"text/css\">@media only screen and (max-width:600px){body[yahoo=fix] .wrapper-inner{width:100%!important;margin:0!important;padding:0!important;-webkit-text-size-adjust:none}body[yahoo=fix] img{max-width:100%;height:auto!important}body[yahoo=fix] .content{font-size:15px;padding-top:1em;padding-bottom:1em;margin:0 20px}body[yahoo=fix] .footer{width:100%!important;padding:0!important}body[yahoo=fix] .footer .unsub{width:70%!important}body[yahoo=fix] .footer .social{width:15%!important}body[yahoo=fix] .footer .social a{padding:.5em;display:block}body[yahoo=fix] .footer .social a img{display:block;margin:0 auto}body[yahoo=fix] .footer p{font-size:12px!important;line-height:1.4!important;padding-left:3%}body[yahoo=fix] .spacer{display:none}}@media only screen and (max-width:480px){table[class=footer] p{padding-left:0;text-align:center}table[class=footer] td{display:block!important}table[class=footer] .unsub{width:100%!important}table[class=footer] .gutter{display:none!important}table[class=footer] .social{width:50%!important;float:left;text-align:center}table[class=content] .half-width-button{display:none!important;height:0!important;width:0!important}}.ExternalClass{width:100%}.ExternalClass,.ExternalClass p,.ExternalClass span,.ExternalClass font,.ExternalClass td,.ExternalClass div{line-height:100%}p{margin:1em 0};\n\t\t\t</style>\n\t\t</head>\n\t\t<body style=\"min-width: 100%; margin: 0; padding: 0; font-family: sans-serif; line-height: 1.4; font-size: 15px; background: #ffffff\" yahoo=\"fix\">\n\t\t<table style=\"max-width:900px;margin:0px auto\" width=\"95%\">\n\t\t\t<tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t<div style=\"max-width: 700px; width: 95%; margin: 0 auto; font-family: sans-serif; font-size: 18px; line-height: 23.8px; color: #2c2b2c;  padding: 7px 7px 7px 7px;\">\n\t\t\t\t\n\t\t\t\t\t\t<p> Hey ${content.user.first_names || \"friend\"}</p>\n\t\t\t\t\t\t<p> <a href=${content.link}> Reset your password </a></p>\n\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t\t</body>\n\t\t</html>`\n\t)\n}\n","module.exports = require(\"aws-sdk\");","module.exports = require(\"bcryptjs\");","module.exports = require(\"dataloader\");","module.exports = require(\"dotenv\");","module.exports = require(\"express-jwt\");","module.exports = require(\"graphql-shield\");","module.exports = require(\"graphql-yoga\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"knex\");","module.exports = require(\"lodash\");","module.exports = require(\"merge-graphql-schemas\");","module.exports = require(\"path\");"],"sourceRoot":""}