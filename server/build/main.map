{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./db/knex.js","webpack:///./knexfile.js","webpack:///./src/context.js","webpack:///./src/index.js","webpack:///./src/loaders/index.js","webpack:///./src/permissions/index.js","webpack:///./src/permissions/isAuthenticated.js","webpack:///./src/resolvers/auth/index.js","webpack:///./src/resolvers/auth/login.js","webpack:///./src/resolvers/auth/me.js","webpack:///./src/resolvers/auth/register.js","webpack:///./src/resolvers/auth/requestPasswordReset.js","webpack:///./src/resolvers/auth/resetPassword.js","webpack:///./src/resolvers/index.js","webpack:///./src/resolvers/permissions/index.js","webpack:///./src/resolvers/users/index.js","webpack:///./src/typeDefs/index.js","webpack:///./src/util/FormatEmail.js","webpack:///./src/util/aws/index.js","webpack:///./src/util/index.js","webpack:///./src/util/templates/EmailRPR.js","webpack:///external \"apollo-server-express\"","webpack:///external \"aws-sdk\"","webpack:///external \"bcryptjs\"","webpack:///external \"connect\"","webpack:///external \"dataloader\"","webpack:///external \"dotenv\"","webpack:///external \"express-jwt\"","webpack:///external \"graphql-shield\"","webpack:///external \"graphql-yoga\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"knex\"","webpack:///external \"merge-graphql-schemas\"","webpack:///external \"path\"","webpack:///external \"qs-middleware\""],"names":["environment","process","env","ENVIRONMENT","config","require","module","exports","development","client","connection","DATABASE_URL","migrations","tableName","directory","production","PRODUCTION_DATABASE_URL","db","req","res","loaders","user","id","Loader","email","connect","ApolloServer","query","jwt","server","typeDefs","resolvers","context","PORT","app","path","use","secret","TOKEN_SECRET","credentialsRequired","getToken","fromHeaderOrQuerystring","headers","authorization","split","token","applyMiddleware","listen","port","console","log","graphqlPath","table","key","DataLoader","keys","whereIn","select","then","rows","map","ikey","find","x","shield","Query","isAuthenticated","rule","cache","parent","args","info","Queries","me","Mutations","login","register","requestPasswordReset","resetPassword","root","load","FormatEmail","credAuthError","code","success","message","valid","bcrypt","compare","password","deleted","jsonwebtoken","sign","expiresIn","formattedEmail","input","existing","nextPage","userData","Object","assign","hash","insert","return","resetToken","templateParams","link","emailParams","Destination","ToAddresses","Message","Body","Text","Charset","Data","EmailRPR","Html","Subject","Source","FROM_EMAIL","sendEmail","ses","promise","validJWT","verify","e","updatedPassword","updatedUser","where","update","returning","AuthQueries","UserQueries","PermissionQueries","Mutation","AuthMutations","permission","permissions","users","toUpperCase","typesArray","fileLoader","__dirname","typesMerged","mergeTypes","trim","AWS","accessKeyId","AWS_ACCESS_KEY","secretAccessKey","AWS_SECRET_KEY","region","SES","apiVersion","type","content","first_name","first_names"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","const environment = process.env.ENVIRONMENT || 'development'\nconst config = require('../knexfile.js')[environment];\nmodule.exports = require('knex')(config);","require(\"dotenv\").config();\n\nmodule.exports = {\n  development: {\n    client: \"pg\",\n    connection: process.env.DATABASE_URL,\n    migrations: {\n      tableName: \"knex_migrations\",\n      directory: `./db/migrations`\n    }\n  },\n  production: {\n    client: \"pg\",\n    connection: process.env.PRODUCTION_DATABASE_URL,\n    migrations: {\n      tableName: \"knex_migrations\",\n      directory: `./db/migrations`\n    }\n  }\n};","const db = require('../db/knex.js');\nimport { userLoaderById, Loader } from './loaders';\nexport default (req, res) => {\n    const loaders = {\n        user: {\n            id: Loader('users', 'id'),\n            email: Loader('users', 'email')\n        }\n    }\n    return {\n        req,\n        res,\n        user: req.user,\n        db,\n        loaders: loaders,\n    }\n};","const connect = require('connect');\nconst { ApolloServer } = require('apollo-server-express');\nconst query = require('qs-middleware');\nconst jwt = require('express-jwt');\nimport { GraphQLServer } from \"graphql-yoga\";\n\nrequire(\"dotenv\").config();\n\n\nimport resolvers from \"./resolvers\";\nimport typeDefs from \"./typeDefs\";\nimport context from './context';\nimport Permissions from './permissions';\n\nconst server = new ApolloServer(\n    { \n        typeDefs, \n        resolvers,\n        context: ({req, res}) => context(req,res),\n    }\n    );\n    \nconst PORT = process.env.PORT || 4000;\nconst app = connect();\nconst path = '/graphql';\n\n\napp.use(query());\n\n// jwt middlewhere\napp.use(jwt({\n    secret: process.env.TOKEN_SECRET,\n    credentialsRequired: false,\n    //allow for auth header or token query param\n    getToken: function fromHeaderOrQuerystring (req) {\n      if (req.headers.authorization && req.headers.authorization.split(' ')[0] === 'Bearer') {\n        return req.headers.authorization.split(' ')[1];\n      } else if (req.query && req.query.token) {\n        return req.query.token;\n      }\n      return null;\n    }\n  }));\n\n\nserver.applyMiddleware({ app, path });\n\napp.listen({ port: PORT }, () =>\n    console.log(`ðŸš€ Server ready at http://localhost:${PORT}${server.graphqlPath}`)\n);\n","import DataLoader from 'dataloader';\nconst db = require('../../db/knex.js');\n\nexport const Loader = (table, key) => new DataLoader(\n    (keys) => {\n        return(\n            db.table(table)\n            .whereIn(key, keys).select()\n            .then(rows => {\n                return(\n                    keys.map(ikey=>{\n                        return(\n                            rows.find(x=>x[key] === ikey)\n                        )\n                    }\n                    )\n                )\n            })\n        )\n    }\n)","import { shield } from 'graphql-shield'\nimport { isAuthenticated } from './isAuthenticated';\n\nexport default shield({\n    Query:{\n        user: isAuthenticated\n    }\n})","import { rule } from 'graphql-shield';\n\nexport const isAuthenticated = rule(`is-authenticated`, { cache:\"contextual\"})(async(parent, args, context, info) => {\n    console.log('Auth Middlewhere')\n    if(!context.user) return false;\n    if(!context.user.id) return false;\n    return true\n})","import { me } from './me';\nimport { login } from './login';\nimport { register } from './register';\nimport { requestPasswordReset } from './requestPasswordReset';\nimport { resetPassword } from './resetPassword';\n\nexport const Queries = {\n    me\n}\n\nexport const Mutations = {\n    login,\n    register,\n    requestPasswordReset,\n    resetPassword,\n}","import jsonwebtoken from 'jsonwebtoken';\nimport bcrypt from 'bcryptjs';\nimport { FormatEmail } from '../../util';\n\nexport const login = async(root,args,context,info) => {\n    // Load user from formatted email\n    const user = await context.loaders.user.email.load(FormatEmail(args.email));\n\n    //set Generic Invalid Credential error\n    const credAuthError = { code: \"DOES_NOT_EXIST\", success: false, message: \"Could not find matching user with these credentials\"};\n\n    // if no user exists return GIC\n    if(!user){\n        return credAuthError\n    }\n\n    // compare password and return GIC if mismatch\n    const valid = await bcrypt.compare(args.password, user.password);\n    if(!valid){\n        return credAuthError\n    }\n\n    //if user has been deleted/suspended return susspension error\n    if(user.deleted){\n        return { code: \"REVOKED\", success: false, message: \"Access for this user account has been revoked.\"}\n    }\n\n    // set token for user\n    const token = jsonwebtoken.sign({ id: user.id, email: user.email }, process.env.TOKEN_SECRET, {\n        expiresIn: '30d'\n    })\n    \n    \n\n    return {\n        code: \"OK\",\n        success: true,\n        message: \"Login Successful\",\n        token: token,\n    }\n};\n","export const me = async(root,args,context,info) => {\n    if(context.user && context.user.id){\n        return await context.loaders.user.id.load(context.user.id);\n    }\n    return null;\n}","import { FormatEmail } from '../../util';\nimport bcrypt from 'bcryptjs';\n\nexport const register = async(root,args,context,info) => {\n    // Load user from formatted email\n    const formattedEmail = FormatEmail(args.input.email);\n    const existing = await context.loaders.user.email.load(formattedEmail);\n    if(existing){\n        return(\n            {\n                code: \"DUPLICATE\",\n                success: false,\n                message: \"Go Log In!\",\n                nextPage: \"/login\"\n            }\n        )\n    }\n\n    const userData = Object.assign({}, args.input, {\n        password: await bcrypt.hash(args.input.password, 10),\n        email: formattedEmail,\n    });\n\n    const user = await context.db('users').insert(userData).return('*');\n\n    return(\n        {\n            code: \"OK\",\n            success: true,\n            message: \"Go Log In!\",\n            nextPage: \"/login\"\n        }\n    )\n\n}","import { FormatEmail } from '../../util';\nimport { ses } from '../../util/aws';\nimport { EmailRPR } from '../../util/templates/EmailRPR';\nimport jsonwebtoken from 'jsonwebtoken';\n\nexport const requestPasswordReset = async ( root, args, context, info ) => {\n    // Load user from formatted email\n    const formattedEmail = FormatEmail(args.email);\n    const user = await context.loaders.user.email.load(formattedEmail);\n\n    //set Generic Invalid Credential error\n    const credAuthError = { code: \"DOES_NOT_EXIST\", success: false, message: \"Could not find matching user with these credentials\"};\n\n    //if not user return GIC\n    if(!user){\n        return credAuthError\n    }\n    const resetToken = jsonwebtoken.sign({ id: user.id, email: user.email }, process.env.TOKEN_SECRET, {\n        expiresIn: '1h'\n    });\n\n    const templateParams = {\n        link: `${args.link}?token=${resetToken}`,\n        user: user\n    }\n\n    // construct email parameters\n    const emailParams = {\n        Destination: {\n            ToAddresses: [user.email]\n          },\n          Message: {\n            Body: {\n              Text: {\n                Charset: \"UTF-8\",\n                Data: EmailRPR(\"text\", templateParams)\n              },\n              Html: {\n                Charset: \"UTF-8\",\n                Data: EmailRPR(\"html\", templateParams)\n              }\n            },\n            Subject: {\n              Charset: \"UTF-8\",\n              Data: \"Request Password Reset\"\n            }\n          },\n          Source: process.env.FROM_EMAIL\n    }\n    \n    const sendEmail = await ses.sendEmail(emailParams).promise();\n\n    return{\n        code: \"OK\",\n        success: true,\n        message: \"Check your email for a reset link\"\n    }\n}","import jsonwebtoken from 'jsonwebtoken';\nimport { FormatEmail } from '../../util';\nimport bcrypt from 'bcryptjs';\n\nexport const resetPassword = async ( root, args, context, info ) => {\n    let validJWT;\n    //verify that a valid jwt was passed in\n    try {\n        validJWT = await jsonwebtoken.verify(args.token, process.env.TOKEN_SECRET);\n    } catch(e){\n        return({\n            code: \"EXPIRED\",\n            success: false,\n            message: \"This token is either invalid or expired\"\n        })\n    }\n\n    // get user from jwt args\n    const user = await context.loaders.user.email.load(FormatEmail(validJWT.email));\n    \n    //set Generic Invalid Credential error\n    const credAuthError = { code: \"DOES_NOT_EXIST\", success: false, message: \"Could not find matching user with these credentials\"};\n\n    // if no user exists return GIC\n    if(!user){\n        return credAuthError\n    }\n\n    // bcrypt new password\n    const updatedPassword = await bcrypt.hash(args.password, 10);\n\n    //update new password\n    const updatedUser = await context.db('users').where('id', user.id).update({password: updatedPassword}).returning('*');\n\n    return{\n        code: \"OK\",\n        success: true,\n        message: \"Password has been updated\"\n    }\n}","import { Queries as AuthQueries, Mutations as AuthMutations } from './auth';\nimport { Queries as UserQueries} from './users';\nimport { Queries as PermissionQueries } from './permissions';\n\n\n\n\nexport default {\n    Query: {\n        ...AuthQueries,\n        ...UserQueries,\n        ...PermissionQueries\n    },\n    Mutation: {\n        ...AuthMutations\n    }\n}\n","\nlet permission = {};\nlet permissions = [{},{}];\n\nexport const Queries = {\n    permission,\n    permissions,\n}","\nlet users = [{},{}];\n\nexport const user = async(root,args,context,info) => {\n    if(args.id){\n        return await context.loaders.user.id.load(args.id);\n    }\n    else if (args.email){\n        return await context.loaders.user.email.load(args.email.toUpperCase());\n    }\n    else return null;\n}\n\nexport const Queries = {\n    user,\n    users,\n}","import * as path from \"path\";\nimport { fileLoader, mergeTypes } from \"merge-graphql-schemas\";\n\nconst typesArray = fileLoader(path.join(__dirname, \"./\"));\nconst typesMerged = mergeTypes(typesArray);\n\nexport default typesMerged;","export const FormatEmail = (email) => {\n    return email.trim().toUpperCase()\n}","import AWS from 'aws-sdk';\n\nAWS.config.update({\n    accessKeyId: process.env.AWS_ACCESS_KEY,\n    secretAccessKey: process.env.AWS_SECRET_KEY,\n    region: 'us-east-1'\n})\n\nexport const ses = new AWS.SES({apiVersion: '2010-12-01'});\n","export { FormatEmail } from './FormatEmail';","export const EmailRPR = (type, content) => {\n\tif (type ==='text'){\n\t\treturn(\n\t\t\t`\n\t\t\t${content.user.first_name || \"friend\"}\n\t\t\tReset your password: ${content.link}\n\t\t\t`\n\t\t)\n\t}\n\n\treturn(\n\t\t`<html xmlns=\"http://www.w3.org/1999/xhtml\">\n\t\t<head>\n\t\t\t<title>Reset Password Request</title>\n\t\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><meta name=\"viewport\" content=\"width=device-width\">\n\t\t\t<style type=\"text/css\">@media only screen and (max-width:600px){body[yahoo=fix] .wrapper-inner{width:100%!important;margin:0!important;padding:0!important;-webkit-text-size-adjust:none}body[yahoo=fix] img{max-width:100%;height:auto!important}body[yahoo=fix] .content{font-size:15px;padding-top:1em;padding-bottom:1em;margin:0 20px}body[yahoo=fix] .footer{width:100%!important;padding:0!important}body[yahoo=fix] .footer .unsub{width:70%!important}body[yahoo=fix] .footer .social{width:15%!important}body[yahoo=fix] .footer .social a{padding:.5em;display:block}body[yahoo=fix] .footer .social a img{display:block;margin:0 auto}body[yahoo=fix] .footer p{font-size:12px!important;line-height:1.4!important;padding-left:3%}body[yahoo=fix] .spacer{display:none}}@media only screen and (max-width:480px){table[class=footer] p{padding-left:0;text-align:center}table[class=footer] td{display:block!important}table[class=footer] .unsub{width:100%!important}table[class=footer] .gutter{display:none!important}table[class=footer] .social{width:50%!important;float:left;text-align:center}table[class=content] .half-width-button{display:none!important;height:0!important;width:0!important}}.ExternalClass{width:100%}.ExternalClass,.ExternalClass p,.ExternalClass span,.ExternalClass font,.ExternalClass td,.ExternalClass div{line-height:100%}p{margin:1em 0};\n\t\t\t</style>\n\t\t</head>\n\t\t<body style=\"min-width: 100%; margin: 0; padding: 0; font-family: sans-serif; line-height: 1.4; font-size: 15px; background: #ffffff\" yahoo=\"fix\">\n\t\t<table style=\"max-width:900px;margin:0px auto\" width=\"95%\">\n\t\t\t<tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t<div style=\"max-width: 700px; width: 95%; margin: 0 auto; font-family: sans-serif; font-size: 18px; line-height: 23.8px; color: #2c2b2c;  padding: 7px 7px 7px 7px;\">\n\t\t\t\t\n\t\t\t\t\t\t<p> Hey ${content.user.first_names || \"friend\"}</p>\n\t\t\t\t\t\t<p> <a href=${content.link}> Reset your password </a></p>\n\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t\t</body>\n\t\t</html>`\n\t)\n}\n","module.exports = require(\"apollo-server-express\");","module.exports = require(\"aws-sdk\");","module.exports = require(\"bcryptjs\");","module.exports = require(\"connect\");","module.exports = require(\"dataloader\");","module.exports = require(\"dotenv\");","module.exports = require(\"express-jwt\");","module.exports = require(\"graphql-shield\");","module.exports = require(\"graphql-yoga\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"knex\");","module.exports = require(\"merge-graphql-schemas\");","module.exports = require(\"path\");","module.exports = require(\"qs-middleware\");"],"sourceRoot":""}